:root{
  --bg1:#33f0df;
  --bg2:#211c55;
  --glass: rgba(255,255,255,0.10);
  --glass2: rgba(255,255,255,0.08);
  --stroke: rgba(255,255,255,0.20);
  --txt: rgba(255,255,255,0.92);
  --muted: rgba(255,255,255,0.65);
  --shadow: rgba(0,0,0,0.35);
  --pink:#ff4aa0;
  --mint:#44ffd2;
  --sky:#4cc6ff;
  --lime:#48ff7b;
  --lava:#ff6a2a;
}

*{ box-sizing:border-box; }
html,body{ height:100%; }
body{
  margin:0;
  font-family: ui-sans-serif, system-ui, -apple-system, "Inter", Arial, sans-serif;
  color:var(--txt);
  overflow:hidden;
  background: radial-gradient(1000px 700px at 50% 10%, rgba(51,240,223,0.45), transparent 60%),
              radial-gradient(1000px 900px at 50% 85%, rgba(255,74,160,0.20), transparent 60%),
              linear-gradient(180deg, #1f2b40, #121226);
}

/* Soft animated color wash */
.bg{
  position:fixed; inset:0;
  background:
    radial-gradient(1200px 900px at 20% 15%, rgba(68,255,210,0.35), transparent 60%),
    radial-gradient(900px 700px at 80% 30%, rgba(76,198,255,0.25), transparent 60%),
    radial-gradient(900px 900px at 45% 85%, rgba(255,106,42,0.18), transparent 60%);
  filter: blur(12px);
  opacity:0.9;
  animation: drift 10s ease-in-out infinite alternate;
}
@keyframes drift{
  from{ transform: translate3d(-1.5%, -1%, 0) scale(1.02); }
  to  { transform: translate3d( 1.2%,  1%, 0) scale(1.04); }
}

#particles{
  position:fixed; inset:0;
  width:100%;
  height:100%;
  pointer-events:none;
}

/* Screens */
.screen{
  position:fixed; inset:0;
  display:grid;
  place-items:center;
  padding: max(18px, env(safe-area-inset-top)) max(14px, env(safe-area-inset-right))
           max(18px, env(safe-area-inset-bottom)) max(14px, env(safe-area-inset-left));
  opacity:0;
  transform: scale(1.01);
  pointer-events:none;
  transition: opacity .35s ease, transform .35s ease;
}
.screen.show{
  opacity:1;
  transform: scale(1);
  pointer-events:auto;
}

.glass{
  background: linear-gradient(180deg, rgba(255,255,255,0.14), rgba(255,255,255,0.07));
  border:1px solid var(--stroke);
  box-shadow: 0 18px 60px var(--shadow);
  border-radius: 26px;
  backdrop-filter: blur(14px);
  -webkit-backdrop-filter: blur(14px);
}

/* Intro */
.introCard{
  width:min(560px, 92vw);
  padding:34px 26px;
  text-align:center;
}
.introTitle{
  font-size: clamp(26px, 4.6vw, 42px);
  font-weight:800;
  letter-spacing:-0.02em;
  background: linear-gradient(90deg, var(--mint), var(--sky), var(--pink));
  -webkit-background-clip:text;
  background-clip:text;
  color:transparent;
  text-shadow: 0 10px 30px rgba(0,0,0,0.25);
}
.introSub{
  margin-top:10px;
  letter-spacing:0.35em;
  font-size: 14px;
  color: var(--muted);
}

/* Menu */
.menuWrap{
  width:min(560px, 92vw);
  text-align:center;
  display:flex;
  flex-direction:column;
  gap:16px;
}
.logo{
  font-size: clamp(44px, 8vw, 76px);
  font-weight:900;
  letter-spacing:-0.03em;
  text-shadow: 0 24px 80px rgba(0,0,0,0.35);
}
.hint{
  color:var(--muted);
  font-size:14px;
}

.btn{
  border:1px solid rgba(255,255,255,0.22);
  background: rgba(255,255,255,0.08);
  color:var(--txt);
  padding:16px 18px;
  border-radius: 999px;
  font-weight:800;
  letter-spacing:0.08em;
  cursor:pointer;
  position:relative;
  overflow:hidden;
  transform: translateZ(0);
}
.btn:active{ transform: scale(0.985); }

.btnPrimary{
  background: linear-gradient(90deg, var(--mint), var(--sky), var(--pink));
  border: none;
  color: rgba(10,10,20,0.92);
  text-shadow: 0 1px 0 rgba(255,255,255,0.35);
}
.btnPrimary .btnGlow{
  position:absolute; inset:-40%;
  background: radial-gradient(circle at 40% 50%, rgba(255,255,255,0.35), transparent 55%);
  animation: glow 1.6s ease-in-out infinite alternate;
}
@keyframes glow{
  from{ transform: translateX(-6%); opacity:0.55; }
  to  { transform: translateX( 6%); opacity:0.85; }
}

.btnGhost{
  background: rgba(255,255,255,0.07);
}

/* Game layout */
#game{
  display:flex;
  padding-bottom: env(safe-area-inset-bottom);
  flex-direction:column;
  gap:12px;
  height: 100dvh; /* важно для iOS Safari */
  min-height: 100vh;
}

.hudTop{
  display:flex;
  align-items:center;
  gap:10px;
  flex-wrap:nowrap;              /* НЕ переносить */
  overflow-x: auto;               /* если не влезло — можно проскроллить */
overflow-y: visible;               /* если не влезло — не ломаем layout */
  padding-top: env(safe-area-inset-top);
  padding-left: env(safe-area-inset-left);
  padding-right: env(safe-area-inset-right);
}
.hudTop::-webkit-scrollbar{ display:none; }
.hearts{ margin-left: auto; flex: 0 0 auto; } /* сердечки прижаты вправо */

.pill{
  min-width: 92px;
  padding:10px 12px;
  border-radius:16px;
  background: rgba(0,0,0,0.14);
  border:1px solid rgba(255,255,255,0.16);
  backdrop-filter: blur(10px);
}
.pillLabel{
  font-size:11px;
  letter-spacing:0.18em;
  color: rgba(255,255,255,0.62);
}
.pillValue{
  font-weight:900;
  font-size:18px;
  line-height:1.1;
}
.pillValue.small{ font-size:14px; font-weight:800; }
.pill.wide{ min-width: 140px; }

.gear{
  margin-left:auto;
  width:44px; height:44px;
  border-radius: 999px;
  border:1px solid rgba(255,255,255,0.18);
  background: rgba(0,0,0,0.18);
  color:rgba(255,255,255,0.92);
  cursor:pointer;
}
.gear:active{ transform: scale(0.98); }

.hearts{
  display:flex;
  gap:6px;
  margin-left:10px;
  padding-top: 6px;
}
.heart{
  width:22px; height:22px;
  border-radius:8px;
  background: radial-gradient(circle at 35% 35%, #fff, rgba(255,255,255,0) 55%),
              linear-gradient(180deg, #ff4aa0, #ff2d6d);
  box-shadow: 0 10px 18px rgba(0,0,0,0.25);
  position:relative;
  transform: rotate(-2deg);
}
.heart::after{
  content:"";
  position:absolute; inset:5px;
  border-radius:6px;
  border:1px solid rgba(255,255,255,0.35);
}
.heart.off{
  filter: grayscale(1) opacity(0.35);
}

.field{
  position:relative;
  width:100%;
  flex: 1 1 auto;               /* поле занимает всё свободное место */
  min-height: 0;                /* важно для flex, чтобы не “распирало” */
  border-radius: 26px;
  background: rgba(0,0,0,0.14);
  border: 1px solid rgba(255,255,255,0.12);
  overflow:hidden;
  box-shadow: inset 0 0 0 1px rgba(255,255,255,0.06);
}

/* Target */
.target{
  position:absolute;
  width: 190px;
  height: 190px;
  border-radius: 999px;
  transform: translate(-50%,-50%);
  left:50%;
  top:58%;
  will-change: left, top, transform;
  pointer-events:none; /* taps go to field, but we compute hit vs circle */
  filter: drop-shadow(0 28px 60px rgba(0,0,0,0.40));
}
.target .ring{
  position:absolute; inset:0;
  border-radius:999px;
}
.target .r1{
  border: 3px solid rgba(255,255,255,0.38);
  box-shadow: inset 0 0 0 1px rgba(255,255,255,0.20);
}
.target .r2{
  inset: 18px;
  border: 2px dashed rgba(255,255,255,0.28);
  animation: spin 2.4s linear infinite;
  opacity: 0.85;
}
@keyframes spin{
  from{ transform: rotate(0deg); }
  to  { transform: rotate(360deg); }
}
.target .core{
  position:absolute;
  inset: 56px;
  border-radius: 999px;
  background: radial-gradient(circle at 35% 35%, rgba(255,255,255,0.75), rgba(255,255,255,0.0) 55%),
              radial-gradient(circle at 50% 55%, rgba(0,0,0,0.22), rgba(0,0,0,0.0) 65%);
  border: 1px solid rgba(255,255,255,0.28);
}

/* Skins */
.skin-aurora{ background: radial-gradient(circle at 35% 25%, rgba(68,255,210,0.65), rgba(0,0,0,0) 55%),
                         radial-gradient(circle at 70% 75%, rgba(255,74,160,0.42), rgba(0,0,0,0) 55%),
                         rgba(76,198,255,0.20); }
.skin-candy{ background: radial-gradient(circle at 35% 30%, rgba(255,255,255,0.45), rgba(0,0,0,0) 55%),
                        radial-gradient(circle at 70% 75%, rgba(255,74,160,0.55), rgba(0,0,0,0) 58%),
                        rgba(255,106,42,0.15); }
.skin-sky{ background: radial-gradient(circle at 35% 25%, rgba(76,198,255,0.65), rgba(0,0,0,0) 55%),
                      radial-gradient(circle at 70% 75%, rgba(68,255,210,0.35), rgba(0,0,0,0) 58%),
                      rgba(120,140,255,0.12); }
.skin-lava{ background: radial-gradient(circle at 35% 25%, rgba(255,106,42,0.72), rgba(0,0,0,0) 58%),
                       radial-gradient(circle at 70% 75%, rgba(255,74,160,0.42), rgba(0,0,0,0) 58%),
                       rgba(255,200,0,0.06); }
.skin-mint{ background: radial-gradient(circle at 35% 25%, rgba(68,255,210,0.80), rgba(0,0,0,0) 60%),
                       radial-gradient(circle at 70% 75%, rgba(76,198,255,0.28), rgba(0,0,0,0) 58%),
                       rgba(40,60,70,0.10); }

/* Feedback - anime style with outline */
.feedback{
  position:absolute;
  left: 16px;
  top: 16px;
  font-weight: 1000;
  font-size: 40px;
  letter-spacing: 0.02em;
  text-transform: uppercase;
  opacity:0;
  transform: translateY(10px) scale(0.98);
  pointer-events:none;
  filter: drop-shadow(0 18px 30px rgba(0,0,0,0.55));
  -webkit-text-stroke: 6px rgba(0,0,0,0.45);
  paint-order: stroke fill;
}
.feedback.show{
  opacity:1;
  transform: translateY(0) scale(1);
  transition: opacity .12s ease, transform .12s ease;
}
.fbPerfect{ color: var(--lime); }
.fbGreat{ color: var(--sky); }
.fbMiss{ color: var(--pink); }

.feedback::after{
  content:"";
  position:absolute;
  inset:-22px -30px;
  background: radial-gradient(circle at 35% 40%, rgba(255,255,255,0.18), transparent 60%),
              radial-gradient(circle at 70% 65%, rgba(255,74,160,0.18), transparent 60%);
  filter: blur(10px);
  opacity:0.9;
  z-index:-1;
}

/* Flash */
.flash{
  position:absolute; inset:0;
  background: radial-gradient(circle at 50% 45%, rgba(255,255,255,0.25), rgba(255,255,255,0) 55%);
  opacity:0;
  pointer-events:none;
}
.flash.on{
  opacity:1;
  transition: opacity .08s ease;
}

/* Flybys (distractors) */
.flybys{
  position:absolute; inset:0;
  pointer-events:none;
}
.fly{
  position:absolute;
  width: 90px; height: 40px;
  border-radius: 999px;
  background: linear-gradient(90deg, rgba(255,255,255,0.0), rgba(255,255,255,0.22), rgba(255,255,255,0.0));
  filter: blur(0.2px);
  opacity:0.75;
  transform: rotate(-8deg);
  animation: fly 1.1s ease-out forwards;
}
@keyframes fly{
  from{ transform: translateX(-30vw) translateY(var(--y)) rotate(-8deg); opacity:0; }
  10%{ opacity:0.8; }
  to{ transform: translateX(120vw) translateY(var(--y)) rotate(10deg); opacity:0; }
}

/* Bottom HUD */
.hudBottom{
  display:flex;
  gap:10px;
  align-items:flex-end;
  padding-bottom: env(safe-area-inset-bottom);
}
.pill.right{ margin-left:auto; }
.pill.energy{ flex:1; min-width: 160px; }
.bar{
  height:10px;
  background: rgba(255,255,255,0.12);
  border:1px solid rgba(255,255,255,0.12);
  border-radius: 999px;
  overflow:hidden;
  margin-top:6px;
}
.fill{
  height:100%;
  width:0%;
  background: linear-gradient(90deg, var(--mint), var(--sky), var(--pink));
  border-radius: 999px;
}

/* Modal */
.modal{
  position:fixed; inset:0;
  display:grid;
  place-items:center;
  padding: 18px;
  background: rgba(0,0,0,0.35);
  opacity:0;
  pointer-events:none;
  transition: opacity .2s ease;
}
.modal.show{
  opacity:1;
  pointer-events:auto;
}
.modalCard{
  width:min(620px, 92vw);
  max-height: 80vh;
  overflow:auto;
  padding: 18px;
}
.modalTop{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  margin-bottom:8px;
}
.modalTitle{
  font-size: 22px;
  font-weight: 900;
}
.xBtn{
  width:40px; height:40px;
  border-radius:12px;
  border:1px solid rgba(255,255,255,0.18);
  background: rgba(0,0,0,0.18);
  color:rgba(255,255,255,0.95);
  cursor:pointer;
}

.row{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:14px;
  padding: 12px 0;
}
.rowTitle{ font-weight:900; }
.rowSub{ color:var(--muted); font-size:13px; margin-top:4px; }
.rowLeft{ display:flex; flex-direction:column; }

.divider{
  height:1px;
  background: rgba(255,255,255,0.12);
  margin: 10px 0;
}
.rowBlock{ padding: 10px 0 16px; }

.skins{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  margin-top:10px;
}
.skinBtn{
  padding:10px 14px;
  border-radius: 999px;
  border:1px solid rgba(255,255,255,0.20);
  background: rgba(255,255,255,0.08);
  color: var(--txt);
  font-weight:800;
  cursor:pointer;
}
.skinBtn.active{
  background: linear-gradient(90deg, var(--mint), var(--sky), var(--pink));
  color: rgba(10,10,20,0.92);
  border:none;
}

.switch{
  position:relative;
  width:54px; height:32px;
}
.switch input{ display:none; }
.slider{
  position:absolute; inset:0;
  border-radius: 999px;
  background: rgba(255,255,255,0.18);
  border:1px solid rgba(255,255,255,0.16);
  cursor:pointer;
}
.slider::after{
  content:"";
  position:absolute;
  width:26px; height:26px;
  left:3px; top:2px;
  border-radius: 999px;
  background: rgba(255,255,255,0.95);
  box-shadow: 0 10px 18px rgba(0,0,0,0.25);
  transition: transform .15s ease;
}
.switch input:checked + .slider{
  background: linear-gradient(90deg, var(--mint), var(--sky), var(--pink));
  border:none;
}
.switch input:checked + .slider::after{ transform: translateX(22px); }

.achList{
  display:flex;
  flex-direction:column;
  gap:10px;
  margin-top:10px;
}
.ach{
  padding:12px 12px;
  border-radius: 18px;
  background: rgba(0,0,0,0.14);
  border:1px solid rgba(255,255,255,0.12);
}
.achTop{
  display:flex;
  justify-content:space-between;
  gap:10px;
}
.achName{ font-weight:900; }
.achState{
  font-weight:900;
  color: var(--muted);
}
.ach.unlocked .achState{ color: var(--lime); }
.achDesc{ color: var(--muted); font-size:13px; margin-top:6px; }

@media (max-width: 420px){
  .pill{ min-width: 84px; }
  .feedback{ font-size: 34px; -webkit-text-stroke: 5px rgba(0,0,0,0.45); }
  .target{ width: 170px; height: 170px; }
}

.hudBottom{
  position: sticky;
  bottom: 0;
  z-index: 20;
  padding-bottom: calc(10px + env(safe-area-inset-bottom));
}