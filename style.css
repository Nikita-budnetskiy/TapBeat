:root{
  --bg1:#2de2e6;
  --bg2:#1b1b3a;
  --bg3:#09091a;

  --skinBorder:#2de2e6;
  --skinGlow:rgba(45,226,230,0.9);
  --skinCore:#f72585;

  --good:#2de2e6;
  --perfect:#7cff6b;
  --miss:#ff2d86;

  --strokeDark:#050616;
}

*{ box-sizing:border-box; -webkit-tap-highlight-color: transparent; }
html,body{ height:100%; }
body{
  margin:0;
  overflow:hidden;
  color:#fff;
  font-family:-apple-system,BlinkMacSystemFont,system-ui,sans-serif;
  background: radial-gradient(circle at top, var(--bg1), var(--bg2), var(--bg3));
}

/* ===== Ambient background: stars + confetti ===== */
.bg-stars, .bg-confetti{
  position:absolute;
  inset:-20%;
  pointer-events:none;
  z-index:0;
}

.bg-stars{
  background:
    radial-gradient(circle at 10% 20%, rgba(255,255,255,0.8) 0 1px, transparent 2px),
    radial-gradient(circle at 30% 70%, rgba(255,255,255,0.7) 0 1px, transparent 2px),
    radial-gradient(circle at 60% 30%, rgba(255,255,255,0.6) 0 1px, transparent 2px),
    radial-gradient(circle at 80% 80%, rgba(255,255,255,0.7) 0 1px, transparent 2px),
    radial-gradient(circle at 50% 50%, rgba(255,255,255,0.5) 0 1px, transparent 2px);
  background-size: 220px 220px, 260px 260px, 320px 320px, 280px 280px, 400px 400px;
  animation: driftStars 22s linear infinite;
  opacity:0.55;
  filter: blur(0.2px);
}
@keyframes driftStars{
  from{ transform: translate3d(0,0,0) scale(1); }
  to{ transform: translate3d(-6%, 8%, 0) scale(1.02); }
}

.bg-confetti{
  background:
    radial-gradient(circle, rgba(255,45,134,0.9) 0 2px, transparent 3px),
    radial-gradient(circle, rgba(124,255,107,0.9) 0 2px, transparent 3px),
    radial-gradient(circle, rgba(45,226,230,0.9) 0 2px, transparent 3px),
    radial-gradient(circle, rgba(255,209,102,0.9) 0 2px, transparent 3px);
  background-size: 160px 160px, 210px 210px, 260px 260px, 320px 320px;
  animation: driftConfetti 14s linear infinite;
  opacity:0.18;
  filter: blur(0.4px);
}
@keyframes driftConfetti{
  from{ transform: translate3d(0,0,0) rotate(0deg); }
  to{ transform: translate3d(10%, -8%, 0) rotate(12deg); }
}

/* ===== Screens ===== */
.screen{
  position:absolute;
  inset:0;
  display:none;
  align-items:center;
  justify-content:center;
  flex-direction:column;
  z-index:10;
}
.screen.active{ display:flex; }

/* ===== Intro ===== */
.intro-card{
  padding:40px 60px;
  border-radius:24px;
  background: rgba(255,255,255,0.10);
  backdrop-filter: blur(20px);
  box-shadow: 0 10px 60px rgba(0,0,0,0.35);
  animation: introIn 900ms ease;
  text-align:center;
}
.intro-card h1{ margin:0; font-size:34px; letter-spacing:-0.02em; }
.intro-card h1 span{ color:var(--bg1); }
.intro-card p{ margin:10px 0 0; opacity:0.7; letter-spacing:0.35em; }
@keyframes introIn{
  from{ opacity:0; transform: translateY(10px) scale(0.96); filter: blur(6px); }
  to{ opacity:1; transform:none; filter:none; }
}

/* ===== Menu ===== */
.logo{
  font-size:56px;
  margin:0 0 30px;
  letter-spacing:-0.02em;
  text-shadow: 0 10px 40px rgba(0,0,0,0.35);
}
.main-btn, .secondary-btn{
  padding:16px 46px;
  margin:10px;
  border-radius:999px;
  font-size:20px;
  border:none;
  cursor:pointer;
}
.main-btn{
  background: linear-gradient(90deg, #2de2e6, #7cff6b, #ff2d86);
  color:#071018;
  font-weight:900;
  box-shadow: 0 12px 40px rgba(0,0,0,0.35);
}
.secondary-btn{
  background: rgba(255,255,255,0.08);
  border: 2px solid rgba(255,255,255,0.25);
  color:#fff;
}

/* ===== Game ===== */
#game{ padding-top: env(safe-area-inset-top); }

.hud{
  position:absolute;
  top:10px; left:10px; right:10px;
  display:flex;
  gap:14px;
  align-items:center;
  justify-content:flex-start;
  z-index: 50;
  pointer-events:auto;
}
.hud-item{
  font-size:13px;
  letter-spacing:0.12em;
  opacity:0.95;
  background: rgba(0,0,0,0.18);
  border:1px solid rgba(255,255,255,0.12);
  border-radius:14px;
  padding:8px 10px;
  backdrop-filter: blur(10px);
}
.hud-item span{ font-weight:900; letter-spacing:0.02em; margin-left:6px; }

.gear{
  margin-left:auto;
  width:44px; height:44px;
  border-radius:999px;
  background: rgba(0,0,0,0.20);
  border: 1px solid rgba(255,255,255,0.14);
  color:#fff;
  font-size:20px;
  cursor:pointer;
  backdrop-filter: blur(10px);
  box-shadow: 0 10px 30px rgba(0,0,0,0.25);
}

/* lives (right top, feels inside the field) */
.lives{
  position:absolute;
  top:70px;
  right:16px;
  z-index: 55;
  display:flex;
  gap:8px;
  pointer-events:none;
}
.heart{
  width:26px; height:26px;
  filter: drop-shadow(0 10px 18px rgba(0,0,0,0.35));
  opacity:0.95;
}
.heart.off{ opacity:0.25; filter:none; }

/* bottom bar */
.bottom-bar{
  position:absolute;
  left:10px; right:10px; bottom:12px;
  z-index: 55;
  display:flex;
  gap:12px;
  align-items:center;
  justify-content:space-between;
  pointer-events:none;
}
.label{
  font-size:13px;
  letter-spacing:0.10em;
  opacity:0.9;
  background: rgba(0,0,0,0.18);
  border:1px solid rgba(255,255,255,0.12);
  padding:8px 10px;
  border-radius:14px;
  backdrop-filter: blur(10px);
}
.energy-wrap{
  display:flex;
  align-items:center;
  gap:10px;
  background: rgba(0,0,0,0.18);
  border:1px solid rgba(255,255,255,0.12);
  padding:8px 10px;
  border-radius:14px;
  backdrop-filter: blur(10px);
}
.energy-label{ font-size:13px; letter-spacing:0.08em; opacity:0.9; }
.energy-track{
  width:160px;
  height:10px;
  border-radius:999px;
  background: rgba(255,255,255,0.12);
  overflow:hidden;
}
.energy-fill{
  height:100%;
  width:0%;
  border-radius:999px;
  background: linear-gradient(90deg, #2de2e6, #7cff6b, #ff2d86, #ffd166);
  box-shadow: 0 0 18px rgba(45,226,230,0.25);
}
.energy-pct{ font-size:13px; letter-spacing:0.08em; opacity:0.9; min-width:44px; text-align:right; }

/* ===== Field (full screen) ===== */
#field{
  position:absolute;
  inset:0;
  z-index: 10;
}

/* ===== Feedback anime style ===== */
.feedback{
  position:absolute;
  top:84px;
  left:16px;
  z-index: 60;
  font-size:54px;
  font-weight:1000;
  letter-spacing:0.05em;
  text-transform: uppercase;
  opacity:0;
  transform: translateY(-6px) scale(0.98);
  pointer-events:none;
  filter: drop-shadow(0 10px 25px rgba(0,0,0,0.45));
}

/* heavy “anime stroke” using multiple shadows */
.feedback.anime{
  text-shadow:
    2px 2px 0 var(--strokeDark),
    -2px 2px 0 var(--strokeDark),
    2px -2px 0 var(--strokeDark),
    -2px -2px 0 var(--strokeDark),
    4px 4px 0 rgba(0,0,0,0.35),
    0 10px 24px rgba(0,0,0,0.45);
}

/* lightning/fire sprite overlays (SVG via pseudo-elements) */
.feedback.fx::before,
.feedback.fx::after{
  content:"";
  position:absolute;
  width:90px;
  height:90px;
  opacity:0.95;
  pointer-events:none;
  filter: drop-shadow(0 10px 18px rgba(0,0,0,0.45));
}

.feedback.fx::before{
  left:-68px;
  top:-20px;
  background-size:contain;
  background-repeat:no-repeat;
  transform: rotate(-8deg);
  background-image: url("data:image/svg+xml;utf8,\
<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 120 120'>\
<path d='M70 5 L25 65 H55 L40 115 L95 50 H65 Z' fill='%23ffd166' stroke='%23050616' stroke-width='6' stroke-linejoin='round'/>\
</svg>");
}

.feedback.fx::after{
  right:-70px;
  top:-14px;
  background-size:contain;
  background-repeat:no-repeat;
  transform: rotate(10deg);
  background-image: url("data:image/svg+xml;utf8,\
<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 120 120'>\
<path d='M60 10 C35 30 45 55 30 65 C25 70 20 80 25 90 C35 110 65 112 80 98 C95 85 92 62 78 50 C70 42 70 30 78 22 C70 25 64 30 60 35 C60 25 62 18 70 10 Z' fill='%23ff2d86' stroke='%23050616' stroke-width='6' stroke-linejoin='round'/>\
</svg>");
}

.feedback.pop{
  opacity:1;
  transform: translateY(0) scale(1);
  animation: pop 420ms ease both;
}
@keyframes pop{
  0%{ transform: translateY(-10px) scale(0.90) rotate(-2deg); opacity:0; }
  55%{ transform: translateY(0) scale(1.10) rotate(1deg); opacity:1; }
  100%{ transform: translateY(0) scale(1); opacity:1; }
}

/* ===== Target ===== */
#target{
  position:absolute;
  width:150px; height:150px;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  z-index: 20;
  pointer-events: auto;
  touch-action: none;
}

/* ensure ANY tap on inner rings counts as tap on target */
#target .ring, #target .core{ pointer-events:none; }

#target .ring{
  position:absolute;
  inset:0;
  border-radius:50%;
  border:5px solid var(--skinBorder);
  box-shadow: 0 0 70px var(--skinGlow);
}
#target .ring1{ opacity:0.95; }
#target .ring2{
  inset:14px;
  border: 2px dashed rgba(255,255,255,0.40);
  opacity: 0.70;
}
#target .core{
  width:22px; height:22px;
  border-radius:50%;
  background: var(--skinCore);
  box-shadow: 0 0 22px rgba(247,37,133,0.8);
}

#target.pulse .ring1{ animation: pulse 180ms ease; }
@keyframes pulse{
  from{ transform: scale(0.98); filter: brightness(0.95); }
  to{ transform: scale(1.08); filter: brightness(1.15); }
}

/* particles */
#particles{
  position:absolute;
  inset:0;
  z-index: 30;
  pointer-events:none;
}
.p{
  position:absolute;
  width:10px; height:10px;
  border-radius:999px;
  opacity:0.95;
  animation: particle 560ms ease-out forwards;
}
@keyframes particle{
  from{ transform: translate(0,0) scale(1); opacity:1; }
  to{ transform: translate(var(--dx), var(--dy)) scale(0.2); opacity:0; }
}

/* flash */
#flash{
  position:absolute;
  inset:0;
  z-index: 15;
  pointer-events:none;
  opacity:0;
  background: radial-gradient(circle at center, rgba(124,255,107,0.18), rgba(45,226,230,0.08), transparent 60%);
}
#flash.on{ animation: flash 180ms ease-out; }
@keyframes flash{
  0%{ opacity:0; }
  30%{ opacity:1; }
  100%{ opacity:0; }
}

/* flybys */
#flybys{
  position:absolute;
  inset:0;
  z-index: 12;
  pointer-events:none;
  opacity:0.9;
}
.fly{
  position:absolute;
  width:34px; height:10px;
  border-radius:999px;
  background: linear-gradient(90deg, rgba(255,255,255,0.0), rgba(255,255,255,0.85), rgba(255,255,255,0.0));
  filter: drop-shadow(0 10px 18px rgba(0,0,0,0.35));
  opacity:0.75;
  animation: fly 1200ms linear forwards;
}
.fly::after{
  content:"♪";
  position:absolute;
  right:-10px;
  top:-18px;
  font-weight:900;
  color:#ffd166;
  text-shadow:
    2px 2px 0 var(--strokeDark),
    -2px 2px 0 var(--strokeDark),
    2px -2px 0 var(--strokeDark),
    -2px -2px 0 var(--strokeDark);
}
@keyframes fly{
  from{ transform: translateX(-20vw) translateY(0) rotate(-8deg); }
  to{ transform: translateX(120vw) translateY(10vh) rotate(12deg); }
}

/* ===== Modal ===== */
.modal{
  position:absolute;
  inset:0;
  display:none;
  align-items:center;
  justify-content:center;
  background: rgba(0,0,0,0.55);
  z-index: 100;
  padding: 18px;
}
.modal.active{ display:flex; }

.modal-card{
  width:min(520px, 100%);
  background: rgba(255,255,255,0.10);
  border: 1px solid rgba(255,255,255,0.18);
  border-radius: 24px;
  padding: 16px;
  backdrop-filter: blur(18px);
  box-shadow: 0 20px 80px rgba(0,0,0,0.45);
}
.modal-head{
  display:flex;
  align-items:center;
  justify-content:space-between;
  margin-bottom: 10px;
}
.modal-head h2{ margin:0; letter-spacing:-0.02em; }
.xbtn{
  width:44px; height:44px;
  border-radius: 14px;
  border: 1px solid rgba(255,255,255,0.18);
  background: rgba(0,0,0,0.25);
  color:#fff;
  font-size:18px;
  cursor:pointer;
}
.row{ display:flex; gap:16px; align-items:center; margin: 12px 0; flex-wrap:wrap; }
.toggle{
  display:flex; gap:10px; align-items:center;
  background: rgba(0,0,0,0.18);
  border: 1px solid rgba(255,255,255,0.14);
  border-radius: 16px;
  padding: 10px 12px;
}
.toggle input{ transform: scale(1.2); }

.slider{
  width:100%;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
  background: rgba(0,0,0,0.18);
  border: 1px solid rgba(255,255,255,0.14);
  border-radius: 16px;
  padding: 10px 12px;
}
.slider input{ width: 60%; }

.section{ margin-top: 10px; }
.section h3{ margin: 8px 0 10px; opacity:0.95; }
.section.small{ opacity:0.85; font-size:13px; }

.skins{
  display:grid;
  grid-template-columns: repeat(3, 1fr);
  gap:10px;
}
.skin{
  border-radius: 16px;
  border:1px solid rgba(255,255,255,0.16);
  background: rgba(0,0,0,0.18);
  padding:10px;
  cursor:pointer;
}
.skin .sw{
  height:44px;
  border-radius: 14px;
  border:2px solid rgba(255,255,255,0.18);
}
.skin .nm{
  margin-top:8px;
  font-size:13px;
  opacity:0.9;
}
.skin.active{
  outline: 2px solid rgba(124,255,107,0.7);
  box-shadow: 0 0 0 6px rgba(124,255,107,0.12);
}

/* reduced motion */
@media (prefers-reduced-motion: reduce){
  .bg-stars,.bg-confetti{ animation:none; }
  .feedback.pop{ animation:none; }
  #target.pulse .ring1{ animation:none; }
}